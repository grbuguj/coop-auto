<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ì‹ë‹¨í‘œ ë³€í™˜ê¸°</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #e8f5e9, #f1f8e9);
      font-family: 'Noto Sans KR', sans-serif;
      color: #2e7d32;
    }
    .container {
      max-width: 1200px;
      margin-top: 30px;
    }
    h2 {
      font-weight: 700;
      color: #1b5e20;
    }
    textarea, input, select {
      font-size: 14px;
      font-family: monospace;
      border-radius: 10px;
      border: 1px solid #c8e6c9;
      padding: 10px;
      transition: all 0.2s ease;
    }
    textarea:focus, input:focus, select:focus {
      outline: none;
      border-color: #66bb6a;
      box-shadow: 0 0 8px rgba(102, 187, 106, 0.4);
    }
    .section-title {
      font-weight: bold;
      margin-bottom: 8px;
      color: #388e3c;
    }

    body, input, select, textarea, button {
      font-family: 'Noto Sans KR', sans-serif;
    }

    /* placeholder ê¸€ì”¨ë„ í†µì¼ */
    input::placeholder,
    textarea::placeholder {
      font-family: 'Noto Sans KR', sans-serif;
    }

    .shadow {
      box-shadow: 0 8px 20px rgba(56, 142, 60, 0.15) !important;
    }
    table.meal-table {
      text-align: center;
      background: #ffffff;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid #c8e6c9;
    }
    table.meal-table th {
      background: #a5d6a7;
      font-weight: 600;
      color: #1b5e20;
    }
    table.meal-table td {
      width: 90px;
      height: 55px;
      cursor: pointer;
      background: #ffffff;
      border: 1px solid #c8e6c9;
      transition: background 0.2s, color 0.2s, transform 0.1s;
      user-select: none;
    }
    table.meal-table td.active {
      background: #43a047;
      color: #ffffff;
      font-weight: bold;
      transform: scale(1.05);
      border: 1px solid #c8e6c9; /* ì›ë˜ í…Œë‘ë¦¬ ìœ ì§€ */
      box-shadow: inset 0 0 0 1px #ffffff; /* âœ… ì•ˆìª½ì— í°ìƒ‰ ë¼ì¸ ì¶”ê°€ */
    }

    table.meal-table td:hover {
      background: #e8f5e9;
    }
    .btn-primary {
      background: #43a047;
      border: none;
      font-weight: bold;
      border-radius: 12px;
      transition: background 0.2s, transform 0.1s;
    }
    .btn-primary:hover {
      background: #2e7d32;
      transform: translateY(-2px);
    }
    .btn-primary:active {
      background: #1b5e20;
      transform: scale(0.98);
    }
    .hidden {
      display: none;
    }
    #resultBox {
      background: #f9fff9;
      border: 1px solid #c8e6c9;
      border-radius: 12px;
      color: #1b5e20;
      font-size: 14px;
      padding: 12px;
      white-space: pre;        /* ì¤„ë°”ê¿ˆ ê·¸ëŒ€ë¡œ, ìë™ ê°œí–‰ ì—†ìŒ */
      overflow-x: auto;        /* ê¸´ ì¤„ì€ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
      font-family: monospace;  /* ê°€ë…ì„± ì¢‹ì€ ê³ ì •í­ í°íŠ¸ ìœ ì§€ */
    }
    label.form-label {
      font-weight: 600;
      color: #2e7d32;
    }
  </style>
</head>
<body>
<div class="container">
  <h2 class="mb-4 text-center">ğŸŒ± ìƒí˜‘ ì‹ë‹¨í‘œ ìë™ ë³€í™˜ê¸° Ver 2.0</h2>

  <!-- ì¢Œìš° ì»¬ëŸ¼ ë™ì¼ ë†’ì´ -->
  <div class="row align-items-stretch">
    <!-- ì™¼ìª½ -->
    <div class="col-md-6 d-flex">
      <form id="menuForm" class="shadow p-4 bg-white rounded flex-fill d-flex flex-column">
        <div class="mb-3">
          <label class="form-label">ë…„ë„:</label>
          <input type="number" class="form-control" name="year" value="2025" required>
        </div>

        <div class="mb-3">
          <label class="form-label">ì‹ë‹¹ ì„ íƒ:</label>
          <select class="form-select" name="cafeteria" id="cafeteriaSelect">
            <option value="í•™ìƒì‹ë‹¹">í•™ìƒì‹ë‹¹</option>
            <option value="2í˜¸ê´€ì‹ë‹¹">2í˜¸ê´€ì‹ë‹¹</option>
            <option value="ì œ1ê¸°ìˆ™ì‚¬ì‹ë‹¹">ì œ1ê¸°ìˆ™ì‚¬ì‹ë‹¹</option>
            <option value="ì‚¬ë²”ëŒ€ì‹ë‹¹" selected>ì‚¬ë²”ëŒ€ì‹ë‹¹</option>
          </select>
        </div>

        <!-- í•™ìƒì‹ë‹¹ -->
        <div class="mb-3 meal-table-wrapper hidden">
          <label class="form-label">ìš”ì¼ë³„ ì½”ë„ˆ ì„ íƒ (í•™ìƒì‹ë‹¹):</label>
          <table class="table meal-table cafeteriaTable" data-cafeteria="í•™ìƒì‹ë‹¹">
            <thead>
            <tr>
              <th>ë¼ë‹ˆ</th>
              <th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th><th>ê¸ˆ</th><th>í† </th><th>ì¼</th>
            </tr>
            </thead>
            <tbody>
            <tr><td>ì¡°ì‹</td><td data-day="mon" data-meal="breakfast"></td><td data-day="tue" data-meal="breakfast"></td><td data-day="wed" data-meal="breakfast"></td><td data-day="thu" data-meal="breakfast"></td><td data-day="fri" data-meal="breakfast"></td><td data-day="sat" data-meal="breakfast"></td><td data-day="sun" data-meal="breakfast"></td></tr>
            <tr><td>ì¤‘ì‹-1ì½”ë„ˆ</td><td data-day="mon" data-meal="lunch_1"></td><td data-day="tue" data-meal="lunch_1"></td><td data-day="wed" data-meal="lunch_1"></td><td data-day="thu" data-meal="lunch_1"></td><td data-day="fri" data-meal="lunch_1"></td><td data-day="sat" data-meal="lunch_1"></td><td data-day="sun" data-meal="lunch_1"></td></tr>
            <tr><td>ì¤‘ì‹-2ì½”ë„ˆ</td><td data-day="mon" data-meal="lunch_2"></td><td data-day="tue" data-meal="lunch_2"></td><td data-day="wed" data-meal="lunch_2"></td><td data-day="thu" data-meal="lunch_2"></td><td data-day="fri" data-meal="lunch_2"></td><td data-day="sat" data-meal="lunch_2"></td><td data-day="sun" data-meal="lunch_2"></td></tr>
            <tr><td>ì¤‘ì‹-3ì½”ë„ˆ</td><td data-day="mon" data-meal="lunch_3"></td><td data-day="tue" data-meal="lunch_3"></td><td data-day="wed" data-meal="lunch_3"></td><td data-day="thu" data-meal="lunch_3"></td><td data-day="fri" data-meal="lunch_3"></td><td data-day="sat" data-meal="lunch_3"></td><td data-day="sun" data-meal="lunch_3"></td></tr>
            <tr><td>ì¤‘ì‹-4ì½”ë„ˆ</td><td data-day="mon" data-meal="lunch_4"></td><td data-day="tue" data-meal="lunch_4"></td><td data-day="wed" data-meal="lunch_4"></td><td data-day="thu" data-meal="lunch_4"></td><td data-day="fri" data-meal="lunch_4"></td><td data-day="sat" data-meal="lunch_4"></td><td data-day="sun" data-meal="lunch_4"></td></tr>
            <tr><td>ì¤‘ì‹-5ì½”ë„ˆA</td><td data-day="mon" data-meal="lunch_5a"></td><td data-day="tue" data-meal="lunch_5a"></td><td data-day="wed" data-meal="lunch_5a"></td><td data-day="thu" data-meal="lunch_5a"></td><td data-day="fri" data-meal="lunch_5a"></td><td data-day="sat" data-meal="lunch_5a"></td><td data-day="sun" data-meal="lunch_5a"></td></tr>
            <tr><td>ì¤‘ì‹-5ì½”ë„ˆB</td><td data-day="mon" data-meal="lunch_5b"></td><td data-day="tue" data-meal="lunch_5b"></td><td data-day="wed" data-meal="lunch_5b"></td><td data-day="thu" data-meal="lunch_5b"></td><td data-day="fri" data-meal="lunch_5b"></td><td data-day="sat" data-meal="lunch_5b"></td><td data-day="sun" data-meal="lunch_5b"></td></tr>
            <tr><td>ì„ì‹</td><td data-day="mon" data-meal="dinner"></td><td data-day="tue" data-meal="dinner"></td><td data-day="wed" data-meal="dinner"></td><td data-day="thu" data-meal="dinner"></td><td data-day="fri" data-meal="dinner"></td><td data-day="sat" data-meal="dinner"></td><td data-day="sun" data-meal="dinner"></td></tr>
            </tbody>
          </table>
        </div>

        <!-- 2í˜¸ê´€ì‹ë‹¹ -->
        <div class="mb-3 meal-table-wrapper hidden">
          <label class="form-label">ìš”ì¼ë³„ ì½”ë„ˆ ì„ íƒ (2í˜¸ê´€ì‹ë‹¹):</label>
          <table class="table meal-table cafeteriaTable" data-cafeteria="2í˜¸ê´€ì‹ë‹¹">
            <thead>
            <tr>
              <th>ë¼ë‹ˆ</th>
              <th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th><th>ê¸ˆ</th><th>í† </th><th>ì¼</th>
            </tr>
            </thead>
            <tbody>
            <tr><td>ì¡°ì‹</td><td data-day="mon" data-meal="breakfast"></td><td data-day="tue" data-meal="breakfast"></td><td data-day="wed" data-meal="breakfast"></td><td data-day="thu" data-meal="breakfast"></td><td data-day="fri" data-meal="breakfast"></td><td data-day="sat" data-meal="breakfast"></td><td data-day="sun" data-meal="breakfast"></td></tr>
            <tr><td>ì¤‘ì‹-1ì½”ë„ˆ</td><td data-day="mon" data-meal="lunch_1"></td><td data-day="tue" data-meal="lunch_1"></td><td data-day="wed" data-meal="lunch_1"></td><td data-day="thu" data-meal="lunch_1"></td><td data-day="fri" data-meal="lunch_1"></td><td data-day="sat" data-meal="lunch_1"></td><td data-day="sun" data-meal="lunch_1"></td></tr>
            <tr><td>ì„ì‹</td><td data-day="mon" data-meal="dinner"></td><td data-day="tue" data-meal="dinner"></td><td data-day="wed" data-meal="dinner"></td><td data-day="thu" data-meal="dinner"></td><td data-day="fri" data-meal="dinner"></td><td data-day="sat" data-meal="dinner"></td><td data-day="sun" data-meal="dinner"></td></tr>
            </tbody>
          </table>
        </div>

        <!-- ì œ1ê¸°ìˆ™ì‚¬ì‹ë‹¹ -->
        <div class="mb-3 meal-table-wrapper hidden">
          <label class="form-label">ìš”ì¼ë³„ ì½”ë„ˆ ì„ íƒ (ì œ1ê¸°ìˆ™ì‚¬ì‹ë‹¹):</label>
          <table class="table meal-table cafeteriaTable" data-cafeteria="ì œ1ê¸°ìˆ™ì‚¬ì‹ë‹¹">
            <thead>
            <tr>
              <th>ë¼ë‹ˆ</th>
              <th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th><th>ê¸ˆ</th><th>í† </th><th>ì¼</th>
            </tr>
            </thead>
            <tbody>
            <tr><td>ì¡°ì‹</td><td data-day="mon" data-meal="breakfast"></td><td data-day="tue" data-meal="breakfast"></td><td data-day="wed" data-meal="breakfast"></td><td data-day="thu" data-meal="breakfast"></td><td data-day="fri" data-meal="breakfast"></td><td data-day="sat" data-meal="breakfast"></td><td data-day="sun" data-meal="breakfast"></td></tr>
            <tr><td>ì¤‘ì‹-1ì½”ë„ˆ</td><td data-day="mon" data-meal="lunch_1"></td><td data-day="tue" data-meal="lunch_1"></td><td data-day="wed" data-meal="lunch_1"></td><td data-day="thu" data-meal="lunch_1"></td><td data-day="fri" data-meal="lunch_1"></td><td data-day="sat" data-meal="lunch_1"></td><td data-day="sun" data-meal="lunch_1"></td></tr>
            <tr><td>ì„ì‹</td><td data-day="mon" data-meal="dinner"></td><td data-day="tue" data-meal="dinner"></td><td data-day="wed" data-meal="dinner"></td><td data-day="thu" data-meal="dinner"></td><td data-day="fri" data-meal="dinner"></td><td data-day="sat" data-meal="dinner"></td><td data-day="sun" data-meal="dinner"></td></tr>
            </tbody>
          </table>
        </div>

        <!-- ì‚¬ë²”ëŒ€ì‹ë‹¹ -->
        <div class="mb-3 meal-table-wrapper">
          <label class="form-label">ìš”ì¼ë³„ ì½”ë„ˆ ì„ íƒ (ì‚¬ë²”ëŒ€ì‹ë‹¹):</label>
          <table class="table meal-table cafeteriaTable" data-cafeteria="ì‚¬ë²”ëŒ€ì‹ë‹¹">
            <thead>
            <tr>
              <th>ë¼ë‹ˆ</th>
              <th>ì›”</th><th>í™”</th><th>ìˆ˜</th><th>ëª©</th><th>ê¸ˆ</th><th>í† </th><th>ì¼</th>
            </tr>
            </thead>
            <tbody>
            <tr><td>ì¡°ì‹</td><td data-day="mon" data-meal="breakfast"></td><td data-day="tue" data-meal="breakfast"></td><td data-day="wed" data-meal="breakfast"></td><td data-day="thu" data-meal="breakfast"></td><td data-day="fri" data-meal="breakfast"></td><td data-day="sat" data-meal="breakfast"></td><td data-day="sun" data-meal="breakfast"></td></tr>
            <tr><td>ì¤‘ì‹-1ì½”ë„ˆ</td><td data-day="mon" data-meal="lunch_1"></td><td data-day="tue" data-meal="lunch_1"></td><td data-day="wed" data-meal="lunch_1"></td><td data-day="thu" data-meal="lunch_1"></td><td data-day="fri" data-meal="lunch_1"></td><td data-day="sat" data-meal="lunch_1"></td><td data-day="sun" data-meal="lunch_1"></td></tr>
            <tr><td>ì¤‘ì‹-2ì½”ë„ˆ</td><td data-day="mon" data-meal="lunch_2"></td><td data-day="tue" data-meal="lunch_2"></td><td data-day="wed" data-meal="lunch_2"></td><td data-day="thu" data-meal="lunch_2"></td><td data-day="fri" data-meal="lunch_2"></td><td data-day="sat" data-meal="lunch_2"></td><td data-day="sun" data-meal="lunch_2"></td></tr>
            <tr><td>ì„ì‹</td><td data-day="mon" data-meal="dinner"></td><td data-day="tue" data-meal="dinner"></td><td data-day="wed" data-meal="dinner"></td><td data-day="thu" data-meal="dinner"></td><td data-day="fri" data-meal="dinner"></td><td data-day="sat" data-meal="dinner"></td><td data-day="sun" data-meal="dinner"></td></tr>
            </tbody>
          </table>
        </div>

        <div class="mb-3">
          <label class="form-label">ì›ë³¸ í…ìŠ¤íŠ¸:</label>
          <textarea class="form-control" name="rawText" rows="8" id="rawText"></textarea>
        </div>
      </form>
    </div>

    <!-- ì˜¤ë¥¸ìª½ -->
    <div class="col-md-6 d-flex">
      <div class="shadow p-4 bg-white rounded flex-fill d-flex flex-column">
        <div class="d-flex mb-2 align-items-center">
          <button id="convertBtn" class="btn btn-success flex-grow-1 me-2">ë³€í™˜í•˜ê¸°</button>
          <button id="copyBtn" class="btn btn-outline-secondary me-2">ê²°ê³¼ ë³µì‚¬</button>
          <span id="copyMsg" class="text-success small" style="display:none;">ë³µì‚¬ ì„±ê³µ!</span>
        </div>
        <h3 class="section-title">ê²°ê³¼:</h3>
        <textarea id="resultBox" class="form-control flex-grow-1" readonly>ì—¬ê¸°ì— ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤. Made by ì¬ì›…</textarea>
      </div>
    </div>
  </div>
</div>

<script>
  let selectedValues = [];
  let isMouseDown = false;
  let dragMode = null;

  function updateSelectedValues() {
    const activeCells = document.querySelectorAll('.cafeteriaTable:not(.hidden) td.active[data-day]');
    selectedValues = Array.from(activeCells).map(cell => ({
      day: cell.dataset.day,
      meal: cell.dataset.meal
    }));
  }

  document.getElementById("convertBtn").addEventListener("click", async function () {
    const formData = {
      year: form.querySelector('input[name="year"]').value,
      cafeteria: form.querySelector('select[name="cafeteria"]').value,
      rawText: document.getElementById('rawText').value,
      selectedMeals: selectedValues
    };
    try {
      const res = await fetch('/convert-ajax', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });
      const text = await res.text();
      resultBox.value = text;
    } catch (err) {
      resultBox.value = 'ì˜¤ë¥˜ ë°œìƒ: ' + err;
    }
  });


  function attachCellEvents() {
    const visibleCells = document.querySelectorAll('.cafeteriaTable:not(.hidden) td[data-day]');
    visibleCells.forEach(cell => {
      const newCell = cell.cloneNode(true);
      cell.parentNode.replaceChild(newCell, cell);
    });
    const freshCells = document.querySelectorAll('.cafeteriaTable:not(.hidden) td[data-day]');
    freshCells.forEach(cell => {
      cell.addEventListener('mousedown', () => {
        isMouseDown = true;
        if (cell.classList.contains('active')) {
          dragMode = "remove";
          cell.classList.remove('active');
        } else {
          dragMode = "add";
          cell.classList.add('active');
        }
        updateSelectedValues();
      });
      cell.addEventListener('mouseover', () => {
        if (isMouseDown) {
          if (dragMode === "add") cell.classList.add('active');
          else if (dragMode === "remove") cell.classList.remove('active');
          updateSelectedValues();
        }
      });
    });
  }

  document.body.addEventListener('mouseup', () => {
    isMouseDown = false;
    dragMode = null;
  });

  const cafeteriaSelect = document.getElementById('cafeteriaSelect');
  const cafeteriaTables = document.querySelectorAll('.cafeteriaTable');

  cafeteriaSelect.addEventListener('change', () => {
    // ëª¨ë“  í…Œì´ë¸” ìˆ¨ê¸°ê¸°
    cafeteriaTables.forEach(t => {
      t.closest('.meal-table-wrapper').classList.add('hidden');
      // ëª¨ë“  tdì—ì„œ active ì œê±°
      t.querySelectorAll('td.active').forEach(td => td.classList.remove('active'));
    });

    // ì„ íƒí•œ ì‹ë‹¹ë§Œ ë³´ì´ê¸°
    const targetTable = document.querySelector(`.cafeteriaTable[data-cafeteria="${cafeteriaSelect.value}"]`);
    if (targetTable) {
      targetTable.closest('.meal-table-wrapper').classList.remove('hidden');
    }

    // ìƒíƒœ ì´ˆê¸°í™”
    isMouseDown = false;
    dragMode = null;
    selectedValues = [];
    updateSelectedValues();
    attachCellEvents();
  });


  const form = document.getElementById('menuForm');
  const resultBox = document.getElementById('resultBox');

  form.addEventListener('submit', async function (e) {
    e.preventDefault();
    const formData = {
      year: form.querySelector('input[name="year"]').value,
      cafeteria: form.querySelector('select[name="cafeteria"]').value,
      rawText: document.getElementById('rawText').value,
      selectedMeals: selectedValues
    };
    try {
      const res = await fetch('/convert-ajax', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData)
      });
      const text = await res.text();
      resultBox.value = text;
    } catch (err) {
      resultBox.value = 'ì˜¤ë¥˜ ë°œìƒ: ' + err;
    }
  });

  // ë³µì‚¬ ë²„íŠ¼ ê¸°ëŠ¥
  document.getElementById("copyBtn").addEventListener("click", () => {
    const resultText = document.getElementById("resultBox").value;
    if (!resultText.trim()) return;

    navigator.clipboard.writeText(resultText).then(() => {
      const msg = document.getElementById("copyMsg");
      msg.style.display = "inline";     // í‘œì‹œ
      setTimeout(() => {
        msg.style.display = "none";     // 2ì´ˆ ë’¤ ìˆ¨ê¸°ê¸°
      }, 2000);
    }).catch(err => {
      console.error("ë³µì‚¬ ì‹¤íŒ¨:", err);
    });
  });



  attachCellEvents();
</script>
</body>
</html>
